

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tensor &mdash; N2D2  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interoperability" href="interoperability.html" />
    <link rel="prev" title="Cells" href="cells.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> N2D2
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/about.html">About N2D2-IP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/simus.html">Performing simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/perfs_tools.html">Performance evaluation tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/tuto.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ONNX Import</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../onnx/convert.html">Obtain ONNX models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx/import.html">Import ONNX models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx/transfer.html">Train from ONNX models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quantization and Export</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quant/post.html">Post-training quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quant/qat.html">Quantization-Aware Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quant/pruning.html">Pruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export/CPP.html">Export: C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export/CPP_STM32.html">Export: C++/STM32</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export/TensorRT.html">Export: TensorRT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export/DNeuro.html">Export: DNeuro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export/ONNX.html">Export: ONNX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../export/legacy.html">Export: other / legacy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">INI File Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ini/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ini/databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ini/data_analysis.html">Stimuli data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ini/environment.html">Stimuli provider (Environment)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ini/layers.html">Network Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ini/target.html">Targets (outputs &amp; losses)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adversarial.html">Adversarial module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="cells.html">Cells</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tensor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manipulating-tensors">Manipulating tensors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coordinates">Coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#index">Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slice">Slice</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-values-method">Set values method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#numpy">Numpy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#to-numpy">To Numpy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#from-numpy">From Numpy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cuda-tensor">CUDA Tensor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synchronization-example">Synchronization example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interoperability.html">Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="export.html">Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">C++/Python core</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core/core.html">Core N2D2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/example.html">Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">C++ API / Developer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_intro.html">Introduction</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">N2D2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Tensor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/python_api/tensor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tensor">
<h1>Tensor<a class="headerlink" href="#tensor" title="Permalink to this heading">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">n2d2.Tensor</span></code> is a wrapper of the <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> object available in N2D2 (see <a class="reference internal" href="../dev_intro.html#dev-tensor-t"><span class="std std-ref">Tensor</span></a>).</p>
<p>The class <code class="xref py py-class docutils literal notranslate"><span class="pre">n2d2.Tensor</span></code> contains a reference to the element which produce it and can be seen as the edge of the computation graph.</p>
</div>
<div class="section" id="id1">
<h2>Tensor<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
</div>
<div class="section" id="manipulating-tensors">
<h2>Manipulating tensors<a class="headerlink" href="#manipulating-tensors" title="Permalink to this heading">¶</a></h2>
<p>For setting and getting value we will be using the following tensor as an example :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span> <span class="o">=</span> <span class="n">n2d2</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 0 0
0 0 0
</pre></div>
</div>
<p>You can set and get values using :</p>
<div class="section" id="coordinates">
<h3>Coordinates<a class="headerlink" href="#coordinates" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Using coordinates</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>If you print the tensor you will see :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 0 0
1 0 0
</pre></div>
</div>
</div>
<div class="section" id="index">
<h3>Index<a class="headerlink" href="#index" title="Permalink to this heading">¶</a></h3>
<p>You can use an index to get or set elements of a tensor.
The index correspond to the flatten representation of your tensor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>If you print the tensor you will see :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2 0 0
0 0 0
</pre></div>
</div>
</div>
<div class="section" id="slice">
<h3>Slice<a class="headerlink" href="#slice" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Slice are supported only for assignment !</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>If you print the tensor you will see :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 3 3
0 0 0
</pre></div>
</div>
</div>
<div class="section" id="set-values-method">
<h3>Set values method<a class="headerlink" href="#set-values-method" title="Permalink to this heading">¶</a></h3>
<p>If you want to set multiple values easily, you can use the method <code class="xref py py-meth docutils literal notranslate"><span class="pre">n2d2.Tensor.set_values()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span><span class="o">.</span><span class="n">set_values</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]])</span>
</pre></div>
</div>
<p>If you print the tensor you will see :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1 2 3
4 5 6
</pre></div>
</div>
</div>
</div>
<div class="section" id="numpy">
<h2>Numpy<a class="headerlink" href="#numpy" title="Permalink to this heading">¶</a></h2>
<div class="section" id="to-numpy">
<h3>To Numpy<a class="headerlink" href="#to-numpy" title="Permalink to this heading">¶</a></h3>
<p>You can create a <code class="docutils literal notranslate"><span class="pre">numpy.array</span></code> using a <code class="xref py py-class docutils literal notranslate"><span class="pre">n2d2.Tensor</span></code> with the class method : <code class="xref py py-meth docutils literal notranslate"><span class="pre">n2d2.Tensor.to_numpy()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span> <span class="o">=</span> <span class="n">n2d2</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">np_array</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
<p>This will create the following tensor :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 0 0
0 0 0
</pre></div>
</div>
<p>By default the <code class="docutils literal notranslate"><span class="pre">numpy.array</span></code> doesn’t create a memory copy meaning that if you want to manipulate a <code class="xref py py-class docutils literal notranslate"><span class="pre">n2d2.Tensor</span></code> you can use the numpy library.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1 1 1
0 0 0
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you do not want to create a memory copy, you should set the parameter <code class="docutils literal notranslate"><span class="pre">copy=True</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np_array</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="from-numpy">
<h3>From Numpy<a class="headerlink" href="#from-numpy" title="Permalink to this heading">¶</a></h3>
<p>You can create a <code class="xref py py-class docutils literal notranslate"><span class="pre">n2d2.Tensor</span></code> using a <code class="docutils literal notranslate"><span class="pre">numpy.array</span></code> with the class method : <code class="xref py py-meth docutils literal notranslate"><span class="pre">n2d2.Tensor.from_numpy()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]])</span>
<span class="n">tensor</span> <span class="o">=</span> <span class="n">n2d2</span><span class="o">.</span><span class="n">Tensor</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">np_array</span><span class="p">)</span>
</pre></div>
</div>
<p>This will create the following tensor :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1 2 3
4 5 6
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You cannot create a <code class="xref py py-class docutils literal notranslate"><span class="pre">n2d2.Tensor</span></code> from a <code class="docutils literal notranslate"><span class="pre">numpy.array</span></code> without a memory copy because Tensor require a contiguous memory space which is not required for an array.</p>
</div>
</div>
</div>
<div class="section" id="cuda-tensor">
<h2>CUDA Tensor<a class="headerlink" href="#cuda-tensor" title="Permalink to this heading">¶</a></h2>
<p>You can store your tensor with CPU or GPU (using <code class="docutils literal notranslate"><span class="pre">CUDA</span></code>). By default, n2d2 creates a CPU tensor.</p>
<p>If you want to create a <code class="docutils literal notranslate"><span class="pre">CUDA</span></code> Tensor you can do so by setting the parameter <code class="docutils literal notranslate"><span class="pre">cuda</span></code> to True in the constructor</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span> <span class="o">=</span> <span class="n">n2d2</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">cuda</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>You can switch from CPU to GPU at anytime :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tensor</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>  <span class="c1"># Converting to a CPU tensor</span>
<span class="n">tensor</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span> <span class="c1"># Converting to a CUDA tensor</span>
</pre></div>
</div>
<p>When working on a <code class="docutils literal notranslate"><span class="pre">CUDA</span></code> tensor you have to understand that they are stored in two different places.</p>
<p>The host and the device. The device is the GPU. The host correspond to your interface with the tensor that exists in the GPU.
You cannot access the device directly, the GPU don’t have input/output functions.</p>
<p>This is why you have two methods to synchronized these two versions (<code class="xref py py-meth docutils literal notranslate"><span class="pre">n2d2.Tensor.htod()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">n2d2.Tensor.dtoh()</span></code>).</p>
<p>Synchronizing the device and the host can be an important overhead, it is recommended to compute everything on the device and to synchronize the host at the end.</p>
<div class="section" id="synchronization-example">
<h3>Synchronization example<a class="headerlink" href="#synchronization-example" title="Permalink to this heading">¶</a></h3>
<p>Let’s consider the following <code class="docutils literal notranslate"><span class="pre">CUDA</span></code> Tensor :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">n2d2</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">cuda</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 0
0 0
</pre></div>
</div>
<p>We set the following values :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">set_values</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1 2
3 4
</pre></div>
</div>
<p>Then we will synchronized the device with the host. this mean that we send the values to the GPU.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">htod</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1 2
3 4
</pre></div>
</div>
<p>As you can see, nothing change when printing the tensor.
We have updated the GPU with the new values.
Now let’s change the values stored in the tensor :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">set_values</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2 3
4 5
</pre></div>
</div>
<p>When printing the tensor we see the new values we just set.
Now let’s synchronize the host with the device !</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">dtoh</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1 2
3 4
</pre></div>
</div>
<p>As you can see when printing the tensor, we now have the old values of the tensor.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="interoperability.html" class="btn btn-neutral float-right" title="Interoperability" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cells.html" class="btn btn-neutral float-left" title="Cells" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, CEA LIST

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>